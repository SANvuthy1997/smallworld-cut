if (self.CavalryLogger) { CavalryLogger.start_js(["3V4rP"]); }

__d("MercuryTypeaheadConstants",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={COMPOSER_FRIENDS_MAX:4,COMPOSER_FB4C_MAX:4,COMPOSER_NON_FRIENDS_MAX:2,COMPOSER_MESSENGER_ONLY_CONTACT_MAX:4,COMPOSER_SHOW_MORE_LIMIT:2,COMPOSER_THREADS_INITIAL_LIMIT:2,COMPOSER_CHATTAB_MAX:5,COMPOSER_PAGES_MAX:4,COMPOSER_WM_MAX:18,USER_TYPE:"user",PAGE_TYPE:"page",THREAD_TYPE:"thread",HEADER_TYPE:"header",SEARCH_TYPE:"search",FRIEND_TYPE:"friend",NON_FRIEND_TYPE:"non_friend",FB4C_TYPE:"fb4c",MEETING_ROOM_PAGE_TYPE:"meeting_room_page",COMMERCE_PAGE_TYPE:"commerce_page",VALID_EMAIL:"^([A-Z0-9._\u0025+-]+\u0040((?!facebook\\.com))[A-Z0-9.-]+\\.[A-Z]{2,4}|(([A-Z._\u0025+-]+[A-Z0-9._\u0025+-]*)|([A-Z0-9._\u0025+-]+[A-Z._\u0025+-]+[A-Z0-9._\u0025+-]*))\u0040(?:facebook\\.com))$"};}),null);
__d("MessagingRealtimeConstants",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={VIEWER_FBID:"realtime_viewer_fbid"};}),null);
__d("MessengerView",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={DETAIL:{COMPOSE:"detail\/compose",THREAD:"detail\/thread"},MASTER:{GROUPS:"master\/groups",PEOPLE:"master\/people",RECENT:"master\/recent",SUPPORT:"master\/support"}};}),null);
__d('AjaxRequest',['ErrorUtils','Keys','PHPQuerySerializer','TimeSlice','URI','UserAgent_DEPRECATED','ZeroRewrites','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(l,m,n){if(!(m instanceof c('URI')))m=new (c('URI'))(m);this.xhr=c('ZeroRewrites').getTransportBuilderForURI(m)();if(n&&l=='GET'){m.setQueryData(n);}else this._params=n;this.method=l;this.uri=m;this.xhr.open(l,m);}var i=window.XMLHttpRequest&&'withCredentials' in new XMLHttpRequest();h.supportsCORS=function(){return i;};h.ERROR='ar:error';h.TIMEOUT='ar:timeout';h.PROXY_ERROR='ar:proxy error';h.TRANSPORT_ERROR='ar:transport error';h.SERVER_ERROR='ar:http error';h.PARSE_ERROR='ar:parse error';h.SERVICE_UNAVAILABLE='ar:noservice';h._inflight=[];function j(){var l=h._inflight;h._inflight=[];l.forEach(function(m){m.abort();});}function k(l){l.onJSON=l.onError=l.onSuccess=null;clearTimeout(l._timer);if(l.xhr&&l.xhr.readyState<4){l.xhr.abort();l.xhr=null;}h._inflight=h._inflight.filter(function(m){return m&&m!=l&&m.xhr&&m.xhr.readyState<4;});}Object.assign(h.prototype,{timeout:60000,streamMode:true,prelude:/^for \(;;\);/,status:null,_eol:-1,_call:function l(m){if(this[m])this[m](this);},_parseStatus:function l(){var m;try{this.status=this.xhr.status;m=this.xhr.statusText;}catch(n){if(this.xhr.readyState>=4){this.errorType=h.TRANSPORT_ERROR;this.errorText=n.message;}return;}if(this.status===0&&!/^(file|ftp)/.test(this.uri)){this.errorType=h.TRANSPORT_ERROR;}else if(this.status>=100&&this.status<200){this.errorType=h.PROXY_ERROR;}else if(this.status>=200&&this.status<300){return;}else if(this.status>=300&&this.status<400){this.errorType=h.PROXY_ERROR;}else if(this.status>=400&&this.status<500){this.errorType=h.SERVER_ERROR;}else if(this.status===503){this.errorType=h.SERVICE_UNAVAILABLE;}else if(this.status>500&&this.status<600){this.errorType=h.PROXY_ERROR;}else if(this.status==1223){return;}else if(this.status>=12001&&this.status<=12156){this.errorType=h.TRANSPORT_ERROR;}else{m='unrecognized status code: '+this.status;this.errorType=h.ERROR;}if(!this.errorText)this.errorText=m;},_parseResponse:function l(){var m,n=this.xhr.readyState;try{m=this.xhr.responseText||'';}catch(o){if(n>=4){this.errorType=h.ERROR;this.errorText='responseText not available - '+o.message;}return;}while(this.xhr){var p=this._eol+1,q=this.streamMode?m.indexOf('\n',p):m.length;if(q<0&&n==4)q=m.length;if(q<=this._eol)break;var r=m;if(this.streamMode)r=m.substr(p,q-p).replace(/^\s*|\s*$/g,'');if(p===0&&this.prelude)if(this.prelude.test(r))r=r.replace(this.prelude,'');this._eol=q;if(r){try{this.json=JSON.parse(r);}catch(o){var s=/(<body[\S\s]+?<\/body>)/i.test(m)&&RegExp.$1,t={message:o.message,'char':p,excerpt:(p===0&&s||r).substr(512)};this.errorType=h.PARSE_ERROR;this.errorText='parse error - '+JSON.stringify(t);return;}c('ErrorUtils').applyWithGuard(this._call,this,['onJSON']);}}},_onReadyState:function l(){var m=this.xhr&&this.xhr.readyState||0;if(this.status==null&&m>=2)this._parseStatus();if(!this.errorType&&this.status!=null)if(m==3&&this.streamMode||m==4)this._parseResponse();if(this.errorType||m==4){this._time=Date.now()-this._sentAt;this._call(!this.errorType?'onSuccess':'onError');k(this);}},send:function l(m){this.xhr.onreadystatechange=c('TimeSlice').guard(this._onReadyState.bind(this),'AjaxRequest xhr.onreadystatechange');var n=this.timeout;if(n)this._timer=c('setTimeoutAcrossTransitions')(function(){this.errorType=h.TIMEOUT;this.errorText='timeout';this._time=Date.now()-this._sentAt;this._call('onError');k(this);}.bind(this),n);h._inflight.push(this);if(this.method=='POST')this.xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');this._sentAt=Date.now();this.xhr.send(m?c('PHPQuerySerializer').serialize(m):'');},abort:function l(){k(this);},toString:function l(){var m='[AjaxRequest readyState='+this.xhr.readyState;if(this.errorType)m+=' errorType='+this.errorType+' ('+this.errorText+')';return m+']';},toJSON:function l(){var m={json:this.json,status:this.status,errorType:this.errorType,errorText:this.errorText,time:this._time};if(this.errorType)m.uri=this.uri;for(var n in m)if(m[n]==null)delete m[n];return m;}});if(window.addEventListener&&c('UserAgent_DEPRECATED').firefox())window.addEventListener('keydown',function(event){if(event.keyCode===c('Keys').ESC)event.prevent();},false);if(window.attachEvent)window.attachEvent('onunload',j);f.exports=h;}),null);
__d('ChannelSubdomain',['Event','JSLogger','Run','LogHistory','setTimeoutAcrossTransitions','WebStorage'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('LogHistory').getInstance('channel'),i=c('JSLogger').create('channel'),j='channel_sub:',k=7,l=100*1000,m=null,n;function o(){var q=c('WebStorage').getLocalStorage();if(n){clearTimeout(n);n=null;}if(q&&m!=null)q.removeItem(j+m);m=null;}function p(q,r,s){var t,u=(q-1)*k;if(s){if(n)clearTimeout(n);m=n=null;}if(r==null)r=Math.floor(Math.random()*u);if(m==null){var v,w,x,y,z,aa,ba;(function(){var ca=c('WebStorage').getLocalStorage();if(ca){v=[];for(w=0;w<ca.length;w++){x=ca.key(w);if(x.indexOf(j)===0){y=parseInt(x.substr(j.length),10);v[y]=parseInt(ca.getItem(x),10);}}z=Date.now()-l;for(w=0;w<u;w++){aa=(w+r)%u;if(!v[aa]||v[aa]<z){m=aa;break;}}if(m!=null){ba=function da(){try{ca.setItem(j+m,Date.now());}catch(ea){h.warn('subdomain set failed',ea.message);}n=c('setTimeoutAcrossTransitions')(ba,l/2);};ba();}else{h.warn('no channel subdomain',v);i.error('subdomain_overflow');}if(typeof window.onpageshow!='undefined'){c('Event').listen(window,'pagehide',o);}else c('Run').onUnload(o);}else m=r;})();}return m==null?null:m%k;}f.exports={allocate:p,clear:o};}),null);
__d('DocRPC',['ErrorUtils'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={_apis:{},_dispatch:function i(j){var k;try{j=JSON.parse(j);}catch(l){throw new Error('DocRPC unparsable dispatch: "'+j+'"');}if(h._apis.hasOwnProperty(j.api)){var m=h._apis[j.api];if(m[j.method])k=c('ErrorUtils').applyWithGuard(m[j.method],m,j.args);}if(k===undefined)k=null;return JSON.stringify(k);},publish:function i(j,k){h._apis[k]=j;},proxy:function i(j,k,l){var i={};l.forEach(function(m){i[m]=function(){var n={api:k,method:m,args:Array.prototype.slice.call(arguments)},o;try{if(j.closed)throw new Error('DocRPC window closed');o=j.DocRPC._dispatch(JSON.stringify(n));}catch(p){c('ErrorUtils').reportError(p);return;}if(typeof o=='string')try{o=JSON.parse(o);}catch(p){throw new Error('DocRPC '+k+'.'+m+' unparsable return: "'+o+'"');}return o;};});return i;}};f.exports=b.DocRPC=h;}),null);
__d('ChannelTransport',['AjaxRequest','ChannelConstants','DocRPC','LogHistory','TimeSlice','URI','bind','setTimeoutAcrossTransitions','BanzaiODS'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('LogHistory').getInstance('channel');function i(){return (1048576*Math.random()|0).toString(36);}function j(u){return !isNaN(u)&&isFinite(u)&&0<=u&&u<=6;}function k(u,v){var w='';if(j(u.subdomain))w=u.subdomain+'-';var x=u.host;x=x===null||x===undefined?'edge-chat':u.host;var y=new (c('URI'))(v).setDomain(w+x+'.'+u.domain).setPort(u.port).setSecure(new (c('URI'))(window.location.href).isSecure());return y;}function l(u){var v={partition:u.partition,cb:i(),failure:u.pingFailuresOnSubdomain};if(u.sticky_token)v.sticky_token=u.sticky_token;if(u.sticky_pool)v.sticky_pool=u.sticky_pool;var w=k(u,'/p').setQueryData(v);h.log('start_p',{uri:w.toString()});var x=new (c('AjaxRequest'))('GET',w);if(c('AjaxRequest').supportsCORS())x.xhr.withCredentials=true;var y=function z(aa){h.log('finish_p',{xhr:aa.toJSON?aa.toJSON():aa,subdomain:u.subdomain,fullHost:u.fullHost});};x.onError=function(z){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendP.error');y(z);if(u.subdomain===null)return;if(j(u.subdomain)){u.pingFailuresOnSubdomain++;u.subdomain++;if(u.subdomain>6)u.subdomain=0;}};x.timeout=u.P_TIMEOUT;x.onSuccess=function(z){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendP.success');y(z);};x.send();}function m(u,v,w){var x=new Image(),y=0,z=function ca(da){x.abort();return da?v():w();};x.onload=c('TimeSlice').guard(function(){h.log('ping_ok',{duration:Date.now()-y});c('BanzaiODS').bumpEntityKey('ChannelTransport','sendPing.success');z(true);},'ChannelTransport image.onload');x.onerror=c('TimeSlice').guard(function(){l(u);c('BanzaiODS').bumpEntityKey('ChannelTransport','sendPing.error');z(false);},'ChannelTransport image.onerror');var aa=c('setTimeoutAcrossTransitions')(x.onerror,10000);x.abort=function(){if(aa){clearTimeout(aa);aa=null;}x.onload=x.onerror=null;};var ba={partition:u.partition,cb:i()};if(u.sticky_token)ba.sticky_token=u.sticky_token;if(u.sticky_pool)ba.sticky_pool=u.sticky_pool;if(u.lastRequestErrorReason){ba.reason=u.lastRequestErrorReason;u.lastRequestErrorReason=null;}if(u.uid&&u.viewerUid){ba.uid=u.uid;ba.viewer_uid=u.viewerUid;}y=Date.now();x.src=k(u,'/ping').setQueryData(ba);return x;}function n(u,v){var w={channel:u.user_channel,partition:u.partition,clientid:u.sessionID,cb:i(),cap:0,uid:u.uid,viewer_uid:u.viewerUid};if(u.sticky_token)w.sticky_token=u.sticky_token;if(u.sticky_pool)w.sticky_pool=u.sticky_pool;if(u.profile)w.profile=u.profile;if(u.capabilities)w.cap=u.capabilities;w.id=v;var x=k(u,'/add_bud').setQueryData(w),y=new (c('AjaxRequest'))('GET',x);if(c('AjaxRequest').supportsCORS())y.xhr.withCredentials=true;y.onError=function(z){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendAdditionalBuddy.error');h.warn('add_buddy_error');};y.onSuccess=function(z){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendAdditionalBuddy.success');h.log('add_buddy_ok');};y.timeout=u.P_TIMEOUT;y.send();}function o(u){var v={channel:u.user_channel,partition:u.partition,clientid:u.sessionID,cb:i(),cap:0,uid:u.uid,viewer_uid:u.viewerUid};if(u.sticky_token)v.sticky_token=u.sticky_token;if(u.sticky_pool)v.sticky_pool=u.sticky_pool;if(u.is_offline||u.shouldSuppressPresence){v.state='offline';}else v.state='active';if(v.state===u.lastPresenceState)return;u.lastPresenceState=v.state;if(u.profile)v.profile=u.profile;if(u.capabilities)v.cap=u.capabilities;var w=k(u,'/active_ping').setQueryData(v),x=new (c('AjaxRequest'))('GET',w);if(c('AjaxRequest').supportsCORS())x.xhr.withCredentials=true;x.onError=function(y){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendActivePing.error');h.warn('active_ping_error');};x.onSuccess=function(y){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendActivePing.success');h.log('active_ping_ok');};x.timeout=u.P_TIMEOUT;x.send();}function p(u,v,w,x){var y=new Date(),z=-1;if(u.userActive>0){z=(y-u.userActive)/1000|0;if(z<0)h.warn('idle_regression',{idleTime:z,now:y.getTime(),userActive:u.userActive});}var aa={channel:u.user_channel,seq:u.seq,partition:u.partition,clientid:u.sessionID,cb:i(),idle:z,qp:'y',cap:0};if(u.state.aiq)aa.aiq=u.state.aiq;if(u.ready)if(u.seqTurSentAt==-1||u.seqTurSentAt==u.seq){aa.tur=u.timeUntilReady;aa.qpmade=u.queueMade;u.seqTurSentAt=u.seq;}aa.pws=u.pws;if(u.sequenceId>0)aa.isq=u.sequenceId;aa.msgs_recv=u.estimatedReceived;if(u.uid&&u.viewerUid){aa.uid=u.uid;aa.viewer_uid=u.viewerUid;}if(u.sticky_token){aa.sticky_token=u.sticky_token;}else{aa.request_batch=1;if(u.msgr_region)aa.msgr_region=u.msgr_region;}if(u.sticky_pool)aa.sticky_pool=u.sticky_pool;if('trace_id' in u)aa.traceid=u.trace_id;if(u.is_offline||u.shouldSuppressPresence){aa.state='offline';}else if(u.userActive>0&&z<60)aa.state='active';u.lastPresenceState=aa.state;if(u.streamingCapable){aa.mode='stream';aa.format='json';}if(u.profile)aa.profile=u.profile;if(u.capabilities)aa.cap=u.capabilities;var ba=k(u,'/pull').setQueryData(aa),ca='GET',da=new (c('AjaxRequest'))(ca,ba);if(c('AjaxRequest').supportsCORS())da.xhr.withCredentials=true;da.timeout=u.streamingCapable?u.STREAMING_TIMEOUT:u.LONGPOLL_TIMEOUT;da.onJSON=function(ea){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendPull.json');v(ea);};da.onSuccess=function(ea){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendPull.success');w(ea);};da.onError=function(){var ea=this.status==12002&&this._time>=u.MIN_12002_TIMEOUT||this.status==504&&this._time>=u.MIN_504_TIMEOUT,fa=ea?w:x;if(ea){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendPull.success');}else c('BanzaiODS').bumpEntityKey('ChannelTransport','sendPull.error');return fa&&fa.apply(this,arguments);};da.send();u.inStreaming=u.streamingCapable;return da;}function q(u){this.manager=u;this.init&&this.init();}function r(u){q.apply(this,arguments);}Object.assign(r.prototype,{logName:'CORS',enterState:function u(v,w){if(this._request){this._request.abort();this._request=null;}if(v=='init')c('setTimeoutAcrossTransitions')(c('bind')(this.manager,'exitState',{status:c('ChannelConstants').OK,stateId:w.stateId}),0);if(!/pull|ping/.test(v))return;var x=this.manager;if(v=='ping'){this._request=m(w,c('bind')(x,'exitState',{status:c('ChannelConstants').OK,stateId:w.stateId}),c('bind')(x,'exitState',{status:c('ChannelConstants').ERROR,stateId:w.stateId}));}else if(v=='pull')this._request=p(w,c('bind')(x,'_processTransportData',w.stateId),c('bind')(x,'exitState',{status:c('ChannelConstants').OK,stateId:w.stateId}),c('bind')(x,'exitState',{status:c('ChannelConstants').ERROR,stateId:w.stateId}));}});function s(u){h.log('iframe_init_constructor');q.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);c('DocRPC').publish(this,'outerTransport');}Object.assign(s.prototype,{logName:'iframe',_initIframe:function u(v){h.log('iframe_init_start');window.onchanneliframeready=function(){h.log('iframe_resources');return v.resources;};window.onchanneliframeloaded=function(){h.log('iframe_loaded');};if(v){this._iframeURI=k(v,v.path);if(v.resources){var w=this._iframeURI.getDomain();v.resources=v.resources.map(function(y){var z=new (c('URI'))(y);if(z.getPath().startsWith('/intern/rsrc.php')&&z.getQueryData().origin!==undefined)return z.addQueryData('origin',w).toString();return y;});}}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);h.log('iframe_uri_set');}catch(x){h.error('iframe_uri_set_error',x);this.exitState({status:c('ChannelConstants').ERROR,stateId:v.stateId},x+'');}},enterState:function u(v,w){if(v=='init'){this._initIframe(w);}else if(/idle|ping|pull/.test(v)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(v!='idle')this.exitState({status:c('ChannelConstants').ERROR,stateId:w.stateId},'iframe not yet loaded');}else if(v=='shutdown')this._initIframe();},_processTransportData:function u(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function u(v){if(this.manager.state=='init'&&v.status==c('ChannelConstants').OK)this._iframeProxy=c('DocRPC').proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}});function t(){this.init=this.init.bind(this);q.apply(this,arguments);}Object.assign(t.prototype,{logName:'iframe(inner)',init:function u(){c('DocRPC').publish(this,'innerTransport');try{var w=c('DocRPC').proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);Object.assign(this,w);this.exitState({status:c('ChannelConstants').OK,stateId:1e+06});}catch(v){h.error('iframe_inner_init_error',v);}},enterState:function u(v,w){if(this._request){this._request.abort();this._request=null;}if(v=='ping'){this._request=m(w,c('bind')(this,'exitState',{status:c('ChannelConstants').OK,stateId:w.stateId}),c('bind')(this,'exitState',{status:c('ChannelConstants').ERROR,stateId:w.stateId}));}else if(v=='pull')this._request=p(w,c('bind')(this,'_processTransportData',w.stateId),c('bind')(this,'exitState',{status:c('ChannelConstants').OK,stateId:w.stateId}),c('bind')(this,'exitState',{status:c('ChannelConstants').ERROR,stateId:w.stateId}));}});f.exports={isSubdomain:j,getURI:k,Transport:q,CORSTransport:r,IframeTransport:s,IframeInnerTransport:t,sendActivePing:o,sendAdditionalBuddyRequest:n};}),null);
__d('ChannelTransportDataLogger',['Arbiter','JSLogger','MercuryLoggingHelper'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=[],i=10,j=function l(m){return m.map(function(n){var o=n;if(n.message||n.delta&&n.delta.body){o=babelHelpers['extends']({},n);if(n.message)o.message=c('MercuryLoggingHelper').obfuscateMessage(n.message);if(n.delta&&n.delta.body)o.delta=c('MercuryLoggingHelper').obfuscateMessage(n.delta);}return o;});},k={log:function l(m){var n={t:m.t,seq:m.seq};if(m.ms)n.ms=j(m.ms);h.push(n);if(h.length>i)h.shift();}};c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(l,m){m.channelTransportLog=h;});f.exports=k;}),null);
__d('ChatProxyConnectionState',[],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(){this.auxiliaryIrisQueues={};this.aiq=null;}h.prototype.subscribeIrisQueue=function(i,j){this.auxiliaryIrisQueues[i]=j;this.updateCaches();};h.prototype.unsubscribeIrisQueue=function(i){delete this.auxiliaryIrisQueues[i];this.updateCaches();};h.prototype.updateCaches=function(){var i=[];for(var j in this.auxiliaryIrisQueues)if(this.auxiliaryIrisQueues.hasOwnProperty(j)){i.push(j);i.push(this.auxiliaryIrisQueues[j]);}if(i.length===0){this.aiq=null;}else this.aiq=i.join(',');};f.exports=h;}),null);
__d('FBAjaxRequest',['AjaxRequest','getAsyncParams'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j,k){k=babelHelpers['extends']({},c('getAsyncParams')(i),k);var l=new (c('AjaxRequest'))(i,j,k);l.streamMode=false;var m=l._call;l._call=function(n){if(n=='onJSON'&&this.json){if(this.json.error){this.errorType=c('AjaxRequest').SERVER_ERROR;this.errorText='AsyncResponse error: '+this.json.error;}this.json=this.json.payload;}m.apply(this,arguments);};l.ajaxReqSend=l.send;l.send=function(n){this.ajaxReqSend(babelHelpers['extends']({},n,k));};return l;}f.exports=h;}),null);
__d('FantailLogger',['FantailConfig'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('FantailConfig').FantailLogQueue,i={debug:function j(k,l){var m;for(var n=arguments.length,o=Array(n>2?n-2:0),p=2;p<n;p++)o[p-2]=arguments[p];h&&(m=h.get(k)).debug.apply(m,[l].concat(o));},info:function j(k,l){var m;for(var n=arguments.length,o=Array(n>2?n-2:0),p=2;p<n;p++)o[p-2]=arguments[p];h&&(m=h.get(k)).info.apply(m,[l].concat(o));},warn:function j(k,l){var m;for(var n=arguments.length,o=Array(n>2?n-2:0),p=2;p<n;p++)o[p-2]=arguments[p];h&&(m=h.get(k)).warn.apply(m,[l].concat(o));},error:function j(k,l){var m;for(var n=arguments.length,o=Array(n>2?n-2:0),p=2;p<n;p++)o[p-2]=arguments[p];h&&(m=h.get(k)).error.apply(m,[l].concat(o));}};f.exports=i;}),null);
__d("MovingStat",[],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){i=i||60000;var j={t:new Date(),count:0,v:0},k=j,l=0,m=0;function n(){var o=new Date()-i;while(k&&k.next&&k.t<o){l-=k.v;m-=k.count;k=k.next;}}this.add=function(o){l+=o;m++;var p=new Date();if(p-j.t<1000){j.v+=o;j.count++;}else{j.next={t:p,v:o,count:1};j=j.next;n();}};this.tally=function(o){o=o||1000;n();return {sum:l,count:m,timeAverage:l*o/i};};}f.exports=h;}),null);
__d('RTISession',['invariant','URI','AjaxRequest','ErrorUtils'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i='.facebook.com';function j(k,l,m,n,o,p,q,r,s){!k?h(0):void 0;!n?h(0):void 0;!o?h(0):void 0;this.domain=k;this.port=l;this.edgePoolName=m;this.stickyToken=n;this.loggedInId=o;this.accountId=p;this.clientProfile=q||'desktop';this.clientId=r;this.capabilities=s;}j.prototype.issueRequest=function(k,l,m,n,o){!k?h(0):void 0;!l?h(0):void 0;!n?h(0):void 0;var p=this.domain.length-i.length,q=p>0&&this.domain.indexOf(i,p)!==-1,r=q?this.domain:this.domain+i,s=(1048576*Math.random()|0).toString(36),t={cb:s,sticky_token:this.stickyToken,uid:this.loggedInId,viewer_uid:this.accountId,sticky_pool:this.edgePoolName,profile:this.clientProfile,clientid:this.clientId,cap:this.capabilities};for(var u in t)!!l[u]?h(0):void 0;Object.assign(t,l);var v=new (c('URI'))(k).setDomain(r).setPort(this.port).setSecure(new (c('URI'))(window.location.href).isSecure()).setQueryData(t),w=m?'POST':'GET',x=new (c('AjaxRequest'))(w,v);x.timeout=o?o*1000:30000;if(x.xhr)x.xhr.withCredentials=true;var y={};x.onSuccess=function(){};x.onJSON=function(){y.data=x.json;y.error=null;c('ErrorUtils').applyWithGuard(n,this,[y]);}.bind(this);x.onError=function(){y.data=null;y.error=x.errorType||'error';c('ErrorUtils').applyWithGuard(n,this,[y]);}.bind(this);x.send(JSON.stringify(m));};f.exports=j;}),null);
__d('ChannelManager',['errorCode','Promise','AjaxRequest','Arbiter','AsyncRequest','ChannelClientID','ChannelConstants','ChannelInitialData','ChannelSubdomain','ChannelTransport','ChannelTransportDataLogger','ChatVisibility','ChatReliabilityInstrumentation','DTSG','Env','FantailLogger','FBAjaxRequest','FBRTCSupport','ISB','JSLogger','LogHistory','MessagingRealtimeConstants','MovingStat','PresenceCookieManager','PresenceState','PresenceUtil','RTISession','SystemEvents','URI','UserActivity','ChatProxyConnectionState','emptyFunction','requestAnimationFrameAcrossTransitions','setIntervalAcrossTransitions','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i,j=c('JSLogger').create('channel'),k=c('LogHistory').getInstance('channel_manager'),l=null,m=c('emptyFunction'),n=new (c('Promise'))(function(aa,ba){m=aa;});function o(aa){l=aa;}var p={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect',sys_online:'init',sys_timetravel:'init'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'reconnect',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping',error_stale:'reconnect!'},reconnect:{ok:'init!',error:'reconnect',sys_online:'reconnect',sys_timetravel:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!',sys_owner:'reconnect',sys_nonowner:'idle!',sys_online:'ping',sys_offline:'idle!',sys_timetravel:'ping'}},q={state:new (c('ChatProxyConnectionState'))(),userActive:Date.now(),created:Date.now(),ready:false,seqTurSentAt:-1,queueMade:'',sequenceId:0,lastPresenceState:null,lastRequestErrorReason:null,seq:0,pingFailuresOnSubdomain:0,pws:'fresh',estimatedReceived:0,sessionID:c('ChannelClientID').getID(),capabilities:c('FBRTCSupport').getCapabilities(),streamingCapable:false,inStreaming:false,shouldSuppressPresence:c('PresenceState').shouldSuppress(),LONGPOLL_TIMEOUT:60000,STREAMING_TIMEOUT:60000,P_TIMEOUT:30000,IFRAME_LOAD_TIMEOUT:30000,MIN_RETRY_INTERVAL:5000,MAX_RETRY_INTERVAL:320000,MIN_12002_TIMEOUT:9000,MIN_504_TIMEOUT:20000,STALL_THRESHOLD:180000,JUMPSTART_THRESHOLD:90000,MIN_INIT_PROBE_DELAY:3000,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12000,CHANNEL_PROXY_REPORTING_MIN_INTERVAL:10000,PROBE_DELAY:60000,PROBE_HEARTBEATS_INTERVAL_LOW:1000,PROBE_HEARTBEATS_INTERVAL_HIGH:5000,STREAMING_EXIT_STATE_ON_CONTINUE:false},r=1,s={},t=0;function u(){return c('AsyncRequest').lastSuccessTime?Math.round((Date.now()-c('AsyncRequest').lastSuccessTime)/1000):-1;}function v(){var aa={};if(i.getConfig('host'))aa[i.getConfig('user_channel')]=i.getConfig('seq',0);return aa;}function w(){var aa=Date.now(),ba=Date.now(),ca={total:0},da='idle',ea=false;c('SystemEvents').subscribe([c('SystemEvents').USER,c('SystemEvents').ONLINE,c('SystemEvents').TIME_TRAVEL],function(ha,ia){x(true);ba=null;i.lastPullTime=Date.now();var ja;switch(ha){case c('SystemEvents').USER:ja=c('SystemEvents').isPageOwner()?c('ChannelConstants').SYS_OWNER:c('ChannelConstants').SYS_NONOWNER;break;case c('SystemEvents').ONLINE:ja=ia?c('ChannelConstants').SYS_ONLINE:c('ChannelConstants').SYS_OFFLINE;break;case c('SystemEvents').TIME_TRAVEL:if(q.skipTimeTravel)return;if(0<ia&&q.reduceTimeTravel){c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'skipping time travel failure. %s',ia);return;}ja=c('ChannelConstants').SYS_TIMETRAVEL;break;}i.exitState({status:ja,stateId:r});});var fa=function ha(ia,ja){var ka=Date.now(),la=null;if(ja){aa=ka;la=ja.nextState||ja.state;}else la=da;c('SystemEvents').checkTimeTravel();if(ba){var ma=Math.round((ka-ba)/1000);if(ma>0){ca[da]=(ca[da]||0)+ma;ca.total+=ma;}}da=la;ba=ka;if(!ia){ca.lastSuccessTime=u();ca.online=c('SystemEvents').isOnline();k.log('rollup',JSON.stringify(ca));}};c('Arbiter').subscribe(c('ChannelConstants').ON_ENTER_STATE,fa);c('setIntervalAcrossTransitions')(fa,60000);c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(ha,ia){ia.channelRollup=ca;});var ga=function ha(){if(i.isShutdown()||i.shouldIdle())return;c('SystemEvents').checkTimeTravel();var ia=Date.now()-(i.lastPullTime||c('Env').start);if(!ea&&ia>q.STALL_THRESHOLD){var ja=u();k.error('stall',JSON.stringify({lastSuccessTime:ja,rollupState:da}));c('ChatReliabilityInstrumentation').logCHANNEL_STALLED(ia.toString());ea=true;}var ka=Date.now()-aa;if(i.state=='pull'&&ka>q.JUMPSTART_THRESHOLD){aa=null;k.warn('jumpstart',JSON.stringify({state:i.state,dormant:ka}));i.enterState('init');}};c('setIntervalAcrossTransitions')(ga,5000);}function x(aa){if(aa){t=0;s={};}else t++;}function y(aa,ba){var ca=!c('AjaxRequest').supportsCORS()||q.forceIframe;if(!q.hasOwnProperty('host'))c('ChatReliabilityInstrumentation').logERROR('channel: no host in config');var da=c('ChannelTransport').isSubdomain(q.subdomain);if(!da||ca){q.fullHost=q.host;}else q.fullHost=q.subdomain+'-'+q.host;c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'received lb info: %s at seq: %s{%s} with '.concat('sticky: %s/%s, subdomain: %s, fullHost: %s, state: %s,').concat(' source: %s, args: %s'),q.sessionID,q.seq,q.sequenceId,q.sticky_token,q.sticky_pool,q.subdomain,q.fullHost,i.state,aa,ba);}i={state:'idle',nextState:null,proxyDown:false,lastPullTime:Date.now(),lastReportOnMisguidedMsgTime:Date.now(),heartbeats:[],setTestCallback:o,backoff:false,sessionRegistered:false,init:function aa(ba,ca){c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'initializing sessionid:%s at iris-seq:%s',q.sessionID,q.sequenceId);this.init=c('emptyFunction');c('Arbiter').subscribe(c('ChannelConstants').GET_RTI_SESSION_REQUEST,function(event,ga){this.informCurrentSession();}.bind(this));c('requestAnimationFrameAcrossTransitions')(function(){c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'using session id: %s at seq: %s {%s} with sticky: %s/%s',q.sessionID,q.seq,q.sequenceId,q.sticky_token,q.sticky_pool);c('UserActivity').subscribe(function(){var ga=c('ChannelTransport').getURI(q,'/U');c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'user activity sessionid: %s at seq: %s/{%s} '+'with sticky: %s/%s state: %s uri:%s',q.sessionID,q.seq,q.sequenceId,q.sticky_token,q.sticky_pool,i.state,ga);if(i.state=='pull'){q.userActive=Date.now();c('ChannelTransport').sendActivePing(q);}});});c('PresenceCookieManager').register('ch',v);var da=this.getConfig('max_conn',2);q.subdomain=c('ChannelSubdomain').allocate(da);if(!c('ChannelTransport').isSubdomain(q.subdomain)){c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'invalid subdomain from ChannelSubdomain: %s',q.subdomain);q.subdomain=null;}this._transportRate=new (c('MovingStat'))(30000);var ea=c('AjaxRequest').supportsCORS()&&!q.forceIframe?'CORSTransport':'IframeTransport';this.transport=new (c('ChannelTransport')[ea])(this);m(this.transport);if(ba)this.enterState(ba,ca);c('requestAnimationFrameAcrossTransitions')(function(){c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(event,ga){if(this._transportRate){ga.transportRate=this._transportRate.tally();ga.transportType=ea;ga.transportVersion=2;}}.bind(this));w();}.bind(this));if(i.getConfig('tryStreaming')&&i.getConfig('fullHost')&&c('AjaxRequest').supportsCORS()&&!q.forceIframe){var fa=q.MIN_INIT_PROBE_DELAY+Math.random()*q.INIT_PROBE_DELAY_RANDOMIZE_RANGE;c('setTimeoutAcrossTransitions')(this._probeTest,fa);}},configure:function aa(){for(var ba=arguments.length,ca=Array(ba),da=0;da<ba;da++)ca[da]=arguments[da];k.log('configure',JSON.stringify(ca));ca.forEach(function(ea){return Object.assign(q,ea);});y('reconnect',JSON.stringify(ca));c('Arbiter').inform(c('ChannelConstants').ON_CONFIG,this);},getConfig:function aa(ba,ca){return q.hasOwnProperty(ba)?q[ba]:ca;},getCompleteConfig:function aa(){return q;},subscribeIrisQueue:function aa(ba,ca){q.state.subscribeIrisQueue(ba,ca);this.exitState({status:c('ChannelConstants').OK,stateId:r});},unsubscribeIrisQueue:function aa(ba){q.state.unsubscribeIrisQueue(ba);},informCurrentSession:function aa(){var ba=null;if(this.sessionRegistered&&q&&q.fullHost&&q.sticky_token&&q.uid)ba=new (c('RTISession'))(q.fullHost,q.port,q.sticky_pool,q.sticky_token,q.uid,q.viewerUid,q.profile,q.sessionID,q.capabilities);c('Arbiter').inform(c('ChannelConstants').RTI_SESSION,ba);},isShutdown:function aa(){return this.state=='shutdown';},shouldIdle:function aa(){return !(c('SystemEvents').isPageOwner()&&c('SystemEvents').isOnline());},_sendIframeError:function aa(ba){var ca=new (c('AsyncRequest'))().setURI('/ajax/presence/reconnect.php').setData({reason:ba,fb_dtsg:c('DTSG').getToken()}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);ca.specifiesWriteRequiredParams()&&ca.send();},_getDelay:function aa(){var ba=Math.min(q.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,t-1)),q.MAX_RETRY_INTERVAL);if(this.proxyDown&&'proxy_down_delay_millis' in q)ba=q.proxy_down_delay_millis;this.proxyDown=false;return Math.floor(ba*(1+Math.random()*.5));},resetDelay:function aa(){x(true);},enterState:function aa(){if(this._inEnterState){k.warn('enterstate_recursion',JSON.stringify({state:this.state,args:arguments}));c('ChatReliabilityInstrumentation').logERROR('enterstate_recursion');}this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(ba){this._inEnterState=false;throw ba;}},_enterState:function aa(ba){var ca=this.backoff?this._getDelay():0;this.backoff=false;if(this.isShutdown()){c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'not executing state due to shutdown mode: %s',ba);return;}if(ba!='idle!'&&this.shouldIdle()){c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'forced idleness');return;}r++;q.stateId=r;clearTimeout(this._deferredTransition);this._deferredTransition=null;if(!this.transport){n.done(function(ia){return ia.enterState('idle');});c('ChatReliabilityInstrumentation').logERROR('called enterState '+ba+' before transport init');}else this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(ba)){if(this._transportRate){var da=this._transportRate.tally().timeAverage,ea=i.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(da>=ea){if(!this._throttled){this._throttled=true;k.warn('throttled','{}');}j.bump('throttle');ca=1000/ea;}}}else if(!(/#$/.test(ba)))ca=this._getDelay();ba=ba.replace(/\W*$/,'');if(!p[ba]){c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'invalid state: %s',ba);throw new Error('invalid state:'+ba);}var fa=Array.from(arguments),ga;if(ca<=0){ga={state:ba};if(this._transportRate)this._transportRate.add(1);this.state=ba;var ha=this['_enter_'+this.state];if(ha){fa.shift();ha.apply(this,fa);}if(/init|idle|pull|ping/.test(this.state)){if(q.streamingCapable&&/pull/.test(this.state))this.heartbeats=[];q.is_offline=!c('ChatVisibility').isOnline();q.capabilities=c('FBRTCSupport').getCapabilities();c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'entering transport state: %s',this.state);if(!this.transport){n.done(function(ia){return ia.enterState(this.state,q);}.bind(this));c('ChatReliabilityInstrumentation').logERROR('called enterState '+ba+' before transport init');}else this.transport.enterState(this.state,q);if(this.state=='ping'){ga.url=c('ChannelTransport').getURI(q).toString();ga.port=q.port||'undefined';}}}else{this.state='idle';this.nextState=ba;ga={state:this.state,delay:ca,nextState:ba};fa[0]=ba+'#';this._deferredTransition=c('setTimeoutAcrossTransitions')(function(){this._deferredTransition=null;this.enterState.apply(this,fa);}.bind(this),ca);}if(/pull/.test(ba)){ga.client_id=q.sessionID;ga.streaming=q.inStreaming;}c('Arbiter').inform(c('ChannelConstants').ON_ENTER_STATE,ga);},exitState:function aa(ba,ca){var da=ba.stateId,ea=ba.status;if(this.isShutdown()||da<r)return;var fa=this.state,ga=Array.from(arguments);ga[0]=ba.status;var ha={state:fa,status:ea};if(/pull/.test(fa)){ha.client_id=q.sessionID;ha.streaming=q.inStreaming;}if(/ping/.test(fa)&&ea!=c('ChannelConstants').OK)ha.url=c('ChannelTransport').getURI(q).toString();if(this.nextState)ha.nextState=this.nextState;if(ca&&ca.errorType){q.lastRequestErrorReason=ca.errorType;ha.xhr=ca.toJSON?ca.toJSON():ca;if(ca.errorType==c('AjaxRequest').SERVICE_UNAVAILABLE){c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'got 5xx http status code, setting long delay');this.proxyDown=true;}delete ha.xhr.json;}else if(ea!=c('ChannelConstants').OK)q.lastRequestErrorReason=ea;if(ca&&ca.json){if(ca.json.t)ha.t=ca.json.t;if(ca.json.reason)ha.reason=ca.json.reason;if(ca.json.seq)ha.seq=ca.json.seq;}c('Arbiter').inform(c('ChannelConstants').ON_EXIT_STATE,ha);var ia=this['_exit_'+fa];if(ia)ea=ia.apply(this,ga)||ea;if(ea!=c('ChannelConstants').OK){x();s[fa]=(s[fa]||0)+1;}var ja=p[this.nextState||fa][ea]||p._all[ea],ka=ja&&ja.replace(/!*$/,'');if(!ka){k.error('terminal_transition',JSON.stringify(ha));this._shutdownHint=c('ChannelConstants').HINT_INVALID_STATE;ja='shutdown!';c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'entering shutdown state');}this._lastState=fa;this._lastStatus=ea;this.enterState(ja);},_processTransportData:function aa(ba,ca){this._processTransportData0(ba,ca,ca.json);},_processTransportData0:function aa(ba,ca,da){var ea=da.t;if('s' in da){da.seq=da.s;delete da.s;}if(da.u&&q.user&&da.u!=q.user){k.warn('misguided_msg',JSON.stringify({user:q.user,target:da.u}));this._reportProxyMisguidedMsg(da.u,q.user);return;}c('ChannelTransportDataLogger').log(da);var fa=q.seq;if('seq' in da){q.seq=da.seq;c('PresenceState').doSync();}switch(ea){case 'continue':if(q.inStreaming&&this.heartbeats.length<1){q.streamingCapable=false;k.log('switch_to_longpoll','{}');c('setTimeoutAcrossTransitions')(this._probeTest,q.PROBE_DELAY);}x(true);if(!q.inStreaming||q.STREAMING_EXIT_STATE_ON_CONTINUE)this.exitState({status:c('ChannelConstants').OK,stateId:ba});break;case 'refresh':case 'refreshDelay':c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'got refresh with reason: %s',da.reason);this.exitState({status:'refresh_'+(da.reason||0),stateId:ba},ca);break;case 'backoff':c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'server told client to back off');x();this.backoff=true;break;case 'lb':var ga=da.lb_info;if(ga){q.sticky_token=ga.sticky;if('pool' in ga)q.sticky_pool=ga.pool;if('sd' in ga){var ha=ga.subdomain;if(c('ChannelTransport').isSubdomain(ha))q.subdomain=ga.subdomain;}if('vip' in ga)q.host=ga.vip;y('chatproxy',JSON.stringify(da));}else k.error('missing_lb_info','{}');break;case 'test_streaming':c('setTimeoutAcrossTransitions')(this._probeTest,500);break;case 'fullReload':c('PresenceCookieManager').clear();k.log('full_reload','{}');this.sessionRegistered=true;this.informCurrentSession();c('Arbiter').inform(c('ChannelConstants').ON_INVALID_HISTORY);x(true);c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'full reload incurred');var ia=c('ChannelConstants').OK;this.exitState({status:ia,stateId:ba},ca);if('ms' in da)this._processMessages(da,fa);break;case 'msg':x(true);this._processMessages(da,fa);break;case 'heartbeat':if(q.inStreaming){var ja=Date.now();if(this.heartbeats.length>0)var ka=ja-this.heartbeats[this.heartbeats.length-1];k.log('heartbeat_interval',JSON.stringify({client_id:q.sessionID,interval:ka}));this.heartbeats.push(ja);}break;case 'batched':var la=da.batches,ma;for(ma=0;ma<la.length;ma++)this._processTransportData0(ba,ca,la[ma]);break;default:c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'got an unknown protocol message: %s',ea);k.error('unknown_msg_type',JSON.stringify({type:ea}));break;}},_processMessages:function aa(ba,ca){var da,ea,fa,ga;if('tr' in ba)q.trace_id=ba.tr;ea=ba.ms;fa=q.seq-ea.length;for(da=0;da<ea.length;da++,fa++){q.estimatedReceived++;if(fa>=ca){ga=ea[da];if(ga.type){var ha=c('ChannelConstants').getArbiterType(ga.type);if(ga.type==='messaging'){var ia={type:'messaging',event:ga.event};if(ga.message){ia.inbox_unread=ga.unread_counts&&ga.unread_counts.inbox;ia.tid=ga.message.tid;ia.mid=ga.message.mid;c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'got message with id: %s',ga.message.mid);}}else if(ga.type==='pages_messaging'){if(ga.unread_counts&&ga.unread_counts.inbox)c('Arbiter').inform(c('ChannelConstants').getArbiterType('pages_inbox_count_update'),{page_id:ga[c('MessagingRealtimeConstants').VIEWER_FBID],inbox_unread:ga.unread_counts.inbox});}else if(ga.type==='skywalker'){ha=c('ChannelConstants').SKYWALKER;}else if(ga.type==='qprimer'){ga.first=!q.ready;if(ga.first){q.ready=true;q.timeUntilReady=Date.now()-q.created;q.queueMade=ga.made;}ha=c('ChannelConstants').CHANNEL_ESTABLISHED;}else if(ga.type==='pws'){q.pws=ga.pws;}else if(ga.type==='delta')q.sequenceId=ga.iseq;c('Arbiter').inform(ha,{obj:ga});}}else k.warn('seq_regression',JSON.stringify({last_seq:ca,messages:ea.length,seq:fa}));}},_enter_init:function aa(){if(s.init>=i.getConfig('MAX_INIT_FAILS',2))return c('setTimeoutAcrossTransitions')(function(){return this.exitState({status:c('ChannelConstants').ERROR_MAX,stateId:r});}.bind(this),0);this._initTimer=c('setTimeoutAcrossTransitions')(function(){return this.exitState({status:c('ChannelConstants').ERROR,stateId:r},'timeout');}.bind(this),q.IFRAME_LOAD_TIMEOUT);},_enter_reconnect:function aa(ba){k.warn('enter_reconnect',ba);c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'entered reconnect with reason: %s',ba);var ca=r;if(!c('PresenceUtil').hasUserCookie()){c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'user has no cookie???');k.warn('no_user_cookie','{}');c('setTimeoutAcrossTransitions')(function(){this._shutdownHint=c('ChannelConstants').HINT_AUTH;this.exitState({status:c('ChannelConstants').ERROR_SHUTDOWN,stateId:ca});}.bind(this),0);return;}var da={reason:ba,fb_dtsg:c('DTSG').getToken()};if(c('ISB').token)da.fb_isb=c('ISB').token;if(l)l(da);var ea=new (c('FBAjaxRequest'))('GET','/ajax/presence/reconnect.php',da);ea.onSuccess=function(){i.configure(ea.json);c('PresenceCookieManager').store();this.exitState({status:c('ChannelConstants').OK,stateId:ca});}.bind(this);ea.onError=function(){var fa=ea.json&&ea.json.error;c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'reconnect error: %s',ea.errorType);if(ea.errorType==c('AjaxRequest').TRANSPORT_ERROR||ea.errorType==c('AjaxRequest').PROXY_ERROR||ea.errorType==c('AjaxRequest').SERVICE_UNAVAILABLE)this._shutdownHint=c('ChannelConstants').HINT_CONN;if(fa&&fa==1356007){this._shutdownHint=c('ChannelConstants').HINT_MAINT;}else if(fa==1357001||fa==1357004||fa==1348009){this._shutdownHint=c('ChannelConstants').HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?c('ChannelConstants').ERROR_SHUTDOWN:c('ChannelConstants').ERROR,stateId:ca},ea);}.bind(this);ea.send();},_enter_shutdown:function aa(){c('Arbiter').inform(c('ChannelConstants').ON_SHUTDOWN,{reason:this._shutdownHint});if('shutdown_recovery_interval_seconds' in q&&q.shutdown_recovery_interval_seconds>0){var ba=q.shutdown_recovery_interval_seconds*1000;c('setTimeoutAcrossTransitions')(function(){c('Arbiter').inform(c('ChannelConstants').ATTEMPT_RECONNECT);this._shutdownHint=null;this.state='reconnect!';this.enterState('reconnect!');}.bind(this),ba);}},_exit_init:function aa(ba){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(ba==c('ChannelConstants').ERROR_MAX)this._sendIframeError(c('ChannelConstants').reason_IFrameLoadGiveUp);},_exit_pull:function aa(ba,ca){var da=ba==c('ChannelConstants').OK;if(da){this.lastPullTime=Date.now();}else{var ea='exit status: '+ba;if(ca&&ca.errorType)ea+=' ajax request error: '+ca.errorType;c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'pull failed with status: %s',ea);}},_exit_ping:function aa(ba){if(ba==c('ChannelConstants').OK){var ca=Date.now()-(this.lastPullTime||c('Env').start);if(ca>q.STALL_THRESHOLD){c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'didnt complete a successful pull for too long');return c('ChannelConstants').ERROR_STALE;}}else c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'ping failed with status: %s',ba);},_reportProxyMisguidedMsg:function aa(ba,ca){c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'misguided message to %s meant for %s',ca,ba);var da=Date.now();if(da-this.lastReportOnMisguidedMsgTime<=q.CHANNEL_PROXY_REPORTING_MIN_INTERVAL)return;this.lastReportOnMisguidedMsgTime=da;var ea={received_uid:ba,expected_uid:ca};if(q.sticky_token)ea.sticky_token=q.sticky_token;var fa=new (c('URI'))('/err_misguided_msg').setDomain(q.host+'.'+q.domain).setPort(q.port).setSecure(new (c('URI'))(window.location.href).isSecure()).setQueryData(ea),ga=new (c('AjaxRequest'))('GET',fa);if(c('AjaxRequest').supportsCORS())ga.xhr.withCredentials=true;ga.onSuccess=function(ha){};ga.onError=function(ha){};ga.onJSON=function(ha,ia){};ga.send();},_probeTest:function aa(){q.streamingCapable=false;var ba=[],ca={mode:'stream',format:'json'};if(q.sticky_token)ca.sticky_token=q.sticky_token;var da=new (c('URI'))('/probe').setDomain(q.fullHost+'.'+q.domain).setPort(q.port).setSecure(new (c('URI'))(window.location.href).isSecure()).setQueryData(ca),ea=new (c('AjaxRequest'))('GET',da);ea.onJSON=function(fa,ga){if(fa&&fa.json&&fa.json.t==='heartbeat'){ba.push(Date.now());if(ba.length>=2){var ha=ba[1]-ba[0];if(ha>=q.PROBE_HEARTBEATS_INTERVAL_LOW&&ha<=q.PROBE_HEARTBEATS_INTERVAL_HIGH){q.streamingCapable=true;k.log('switch_to_streaming','{}');}}}};ea.onSuccess=function(fa){if(ba.length!=2){q.streamingCapable=false;k.error('probe_error',JSON.stringify({error:'beats.length = '+ba.length}));}k.log('probe_success','{}');};ea.onError=function(fa){q.streamingCapable=false;k.error('probe_error',JSON.stringify(fa));};ea.send();}};f.exports=i;function z(){if(c('ChannelInitialData').channelConfig){i.configure(c('ChannelInitialData').channelConfig);if(/shutdown/.test(c('ChannelInitialData').state))i._shutdownHint=c('ChannelConstants')[c('ChannelInitialData').reason];i.init(c('ChannelInitialData').state,c('ChannelInitialData').reason);c('ChatReliabilityInstrumentation').logCHANNEL_INIT();}else c('ChatReliabilityInstrumentation').logCHANNEL_NOCONFIG();}z();}),3);
__d('ChatSearchSource',['requireWeak','AbstractSearchSource','AsyncRequest','CurrentUser','MercuryConfig','MercuryParticipantTypes','SearchableEntry','SearchSourceCallbackManager','ShortProfiles','TokenizeUtil','debounce','emptyFunction','isValidUniqueID'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=null;c('requireWeak')('OrderedFriendsList',function(l){j=l;});h=babelHelpers.inherits(k,c('AbstractSearchSource'));i=h&&h.prototype;function k(l){i.constructor.call(this);this.$ChatSearchSource1=new (c('SearchSourceCallbackManager'))({parseFn:c('TokenizeUtil').parse,matchFn:c('TokenizeUtil').isQueryMatch,indexFn:l.indexFn});this.$ChatSearchSource2=l.queryRequests||[];this.$ChatSearchSource3=false;this.$ChatSearchSource4=c('debounce')(this.$ChatSearchSource4,100,this);}k.prototype.bootstrapImpl=function(l){c('ShortProfiles').fetchAll().done(function(){this.$ChatSearchSource3=true;this.$ChatSearchSource5();l();}.bind(this));};k.prototype.searchImpl=function(l,m,n){var o=null,p={},q=n&&n.onQueryFinished,r=n&&n.onQueryStarted;r&&r(l);var s=this.$ChatSearchSource1.search(l,function(v){if(!o){o=v;o.forEach(function(w){return p[w.getUniqueID()]=true;});}else v.forEach(function(w){var x=w.getUniqueID();if(!p[x]){o.push(w);p[x]=true;}});m(o,l);if(l.length===1&&this.$ChatSearchSource3)q&&q(l);}.bind(this),n);if(!s||!this.$ChatSearchSource2||!this.$ChatSearchSource2.length||l.length===0){q&&q(l);return;}if(l.length===1){if(this.$ChatSearchSource3)q&&q(l);return;}var t={value:l,existing_ids:o&&o.map(function(v){return v.getUniqueID();}).join(','),limit:n&&n.threadLimit},u=this.$ChatSearchSource2.length;this.$ChatSearchSource2.forEach(function(v){this.$ChatSearchSource4(t,v,function(w){this.$ChatSearchSource6(this.$ChatSearchSource7(this.$ChatSearchSource8(w)).filter(function(x){return !!x;}),l);u--;if(u===0){this.$ChatSearchSource1.setQueryStringAsExhausted(l);q&&q(l);}}.bind(this));}.bind(this),this);};k.prototype.getAllEntriesMap=function(){return this.$ChatSearchSource1.getAllEntries();};k.prototype.$ChatSearchSource5=function(){var l=c('ShortProfiles').getCachedProfileIDs(),m=l.filter(function(o){var p=c('ShortProfiles').getNow(o);return (o==c('CurrentUser').getID()||p.type===c('MercuryParticipantTypes').FRIEND||p.type===c('MercuryParticipantTypes').PAGE&&c('MercuryConfig').LinkedAgents&&c('MercuryConfig').LinkedAgents.indexOf(o.toString())>-1);}),n=m.map(this.$ChatSearchSource9);if(n.length)this.$ChatSearchSource1.addLocalEntries(n);};k.prototype.$ChatSearchSource7=function(l){return l.map(this.$ChatSearchSource10,this);};k.prototype.$ChatSearchSource10=function(l,m){if(l.mercury_thread){if(!j)return null;return j.normalizeThreadEntry(l,m);}var n=l.text,o=l.uid;if(!n||!c('isValidUniqueID')(o))return null;var p=j?j.getActiveRank(o):0;if(j&&!j.contains(o))p+=m;return new (c('SearchableEntry'))({uniqueID:o,title:n,order:p,subtitle:l.subtext,type:l.render_type||l.type,photo:l.photo,uri:l.path,auxiliaryData:{isMessengerUser:l.is_messenger_user,alias:l.alias}});};k.prototype.$ChatSearchSource8=function(l){var m=l.getPayload();if(Array.isArray(m)){return m;}else if(m&&m.entries){return m.entries;}else return [];};k.prototype.$ChatSearchSource9=function(l){var m=c('ShortProfiles').getNow(l),n=l==c('CurrentUser').getID()?c('MercuryParticipantTypes').FRIEND:m.type,o=[m.additionalName,m.alternateName].concat(m.searchTokens||[]).join(' '),p=m.name,q=null;if(m.threadNickname){p=m.threadNickname;q=m.name;}return new (c('SearchableEntry'))({uniqueID:l,title:p,order:j?j.getActiveRank(l):0,subtitle:q,keywordString:o,type:n,photo:m.thumbSrc,uri:m.uri,auxiliaryData:{isMessengerUser:m.is_messenger_user,alias:m.alias}});};k.prototype.$ChatSearchSource4=function(l,m,n,o){new (c('AsyncRequest'))(m.uri).setData(babelHelpers['extends']({},l,m.data)).setMethod('GET').setReadOnly(true).setHandler(n).setErrorHandler(o||c('emptyFunction')).setAllowCrossPageTransition(true).send();};k.prototype.$ChatSearchSource6=function(l,m){if(l.length)this.$ChatSearchSource1.addQueryEntries(l,m);};k.prototype.addLocalEntries=function(l){this.$ChatSearchSource1.addLocalEntries(l);};k.prototype.refreshData=function(){c('ShortProfiles').fetchAll();};f.exports=k;}),null);
__d('MercuryFilters',['MessagingTag','arrayContains'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=[c('MessagingTag').UNREAD],i={ALL:'all',NONPRIORITY:'non-priority',UNREAD:c('MessagingTag').UNREAD,getSupportedFilters:function j(){return h.concat();},isSupportedFilter:function j(k){return c('arrayContains')(h,k);}};f.exports=i;}),null);
__d('MessengerURIConstants',[],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={COMPOSE_SUBPATH:'/new',GROUPS_PATH:'/groups',PEOPLE_PATH:'/people',SUPPORT_PATH:'/support',FILTERED_REQUESTS_PATH:'/filtered',MESSAGE_REQUESTS_PATH:'/requests',THREAD_PREFIX:'/t/',GROUP_PREFIX:'group-'};f.exports=h;}),null);
__d('MessengerStateProcessor',['MercuryAPIArgsSource','MercuryIDs','MercuryParticipantTypes','MercuryParticipants','MercuryThreadIDMap','MercuryThreads','MercuryVanityIDMap','MessengerURIConstants'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={preprocess:function j(k){var l=k.activeThreadID;if(l){var m=c('MercuryIDs').getUserIDFromThreadID(l),n=m&&c('MercuryParticipants').getNow(c('MercuryIDs').getParticipantIDFromUserID(m));if(n&&n.type!==c('MercuryParticipantTypes').EVENT){k.threadKey=n.vanity||m;}else if(m&&!n){var o=c('MercuryIDs').getParticipantIDFromUserID(m);k.threadKey=c('MercuryVanityIDMap').hasID(o)?c('MercuryVanityIDMap').getVanity(o):m;}else{var p=c('MercuryThreadIDMap').get(),q=p.getServerIDFromClientIDNow(l);k.threadKey=q||c('MercuryIDs').tokenize(l).value;}}delete k.activeThreadID;return k;},postprocess:function j(k){var l=c('MercuryThreadIDMap').get(),m=c('MercuryThreads').get(),n=i(k.threadKey),o=void 0;o=c('MercuryIDs').isValid(n)?n:l.getClientIDFromServerIDNow(n);if(!o){var p=c('MercuryParticipants').getIDFromVanityOrFBID(n),q=p&&m.getCanonicalThreadToParticipant(p,null,c('MercuryAPIArgsSource').MESSENGER);if(q)o=q.thread_id;}if(o){k.activeThreadID=o;k.serverThreadID=l.getServerIDFromClientIDNow(o);}delete k.threadKey;return k;},supportInboxPostprocess:function j(k){if(k.threadKey)k.activeThreadID=c('MercuryIDs').getThreadIDFromSupportInboxItemID(k.threadKey);delete k.threadKey;return k;}};function i(j){if(!j)return null;return j.startsWith(c('MessengerURIConstants').GROUP_PREFIX)?j.substr(c('MessengerURIConstants').GROUP_PREFIX.length):j;}f.exports=h;}),null);
__d('MessengerURISerializer',['MercuryFilters','MessagingTag','MessengerStateProcessor','MessengerURIConstants','MessengerView','URI','WWWBase'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h='/?$',i={serialize:function k(l){var m=new (c('URI'))(c('WWWBase').uri);l=c('MessengerStateProcessor').preprocess(l);switch(l.masterView){case c('MessengerView').MASTER.GROUPS:m.setPath(c('MessengerURIConstants').GROUPS_PATH);break;case c('MessengerView').MASTER.PEOPLE:m.setPath(c('MessengerURIConstants').PEOPLE_PATH);break;case c('MessengerView').MASTER.SUPPORT:m.setPath(c('MessengerURIConstants').SUPPORT_PATH);break;}switch(l.folder){case c('MessagingTag').OTHER:m.setPath(c('MessengerURIConstants').FILTERED_REQUESTS_PATH);break;case c('MessagingTag').PENDING:m.setPath(c('MessengerURIConstants').MESSAGE_REQUESTS_PATH);break;}if(l.detailView===c('MessengerView').DETAIL.COMPOSE){m.setPath(m.getPath()+c('MessengerURIConstants').COMPOSE_SUBPATH);}else if(l.threadKey)m.setPath(m.getPath()+c('MessengerURIConstants').THREAD_PREFIX+l.threadKey);if(l.extraQueryParms)m.addQueryData(l.extraQueryParams);if(c('MercuryFilters').isSupportedFilter(l.filter))m.addQueryData({filter:l.filter});if(l.query!=null){var n;m.addQueryData((n={},n[l.queryAll?'qa':'q']=l.query,n));}if(l.mid)m.addQueryData({mid:l.mid});return m;},deserialize:function k(l){var m={},n=l.getPath();if(n.match('^'+c('MessengerURIConstants').GROUPS_PATH)){m.masterView=c('MessengerView').MASTER.GROUPS;}else if(n.match('^'+c('MessengerURIConstants').PEOPLE_PATH)){m.masterView=c('MessengerView').MASTER.PEOPLE;}else if(n.match('^'+c('MessengerURIConstants').SUPPORT_PATH)){m.masterView=c('MessengerView').MASTER.SUPPORT;}else m.masterView=c('MessengerView').MASTER.RECENT;if(n.match('^'+c('MessengerURIConstants').FILTERED_REQUESTS_PATH)){m.folder=c('MessagingTag').OTHER;}else if(n.match('^'+c('MessengerURIConstants').MESSAGE_REQUESTS_PATH)){m.folder=c('MessagingTag').PENDING;}else m.folder=c('MessagingTag').INBOX;if(n.match(c('MessengerURIConstants').COMPOSE_SUBPATH+h)){m.detailView=c('MessengerView').DETAIL.COMPOSE;}else{var o=j(n);if(o){m.threadKey=o;m.detailView=c('MessengerView').DETAIL.THREAD;}}var p=l.getQueryData(),q=p.filter,r=p.mid,s=p.q,t=p.qa,u=babelHelpers.objectWithoutProperties(p,['filter','mid','q','qa']);if(c('MercuryFilters').isSupportedFilter(q)){m.filter=q;}else m.filter=c('MercuryFilters').ALL;m.mid=r;m.query=t||s;m.queryAll=!!t;m.extraQueryParams=u;if(m.masterView===c('MessengerView').MASTER.SUPPORT)return c('MessengerStateProcessor').supportInboxPostprocess(m);return c('MessengerStateProcessor').postprocess(m);}};function j(k){var l=k.match(c('MessengerURIConstants').THREAD_PREFIX+'([^/]+)'+h);return l&&l[1];}f.exports=i;}),null);
__d('MessengerActions',['invariant','MercuryIDs','MessengerDispatcher','MessengerURISerializer','MercuryTypeaheadConstants','MessengerView','URI','goURI','keyMirror'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('keyMirror')({HIDE_DIALOG:null,REPLACE_STATE:null,SHOW_DIALOG:null}),j={Types:i,changeDetailView:function l(m){k(function(n){if(n.detailView!==m)return {detailView:m};});},changeMasterView:function l(m){k(function(n){if(n.masterView!==m)return {masterView:m};});},selectThread:function l(m,n){if(n===c('MercuryTypeaheadConstants').MEETING_ROOM_PAGE_TYPE){!!!m?h(0):void 0;var o=c('MercuryIDs').getUserIDFromThreadID(m);!!!o?h(0):void 0;var p=new (c('URI'))(),q=p.getQualifiedURI().getSubdomain();p.setDomain('facebook.com').setSubdomain(q).setPath('/'+o).setProtocol('https');window.open(p,'_blank');return;}k(function(r){if(r.activeThreadID!==m)return {activeThreadID:m,detailView:c('MessengerView').DETAIL.THREAD,mid:null,query:r.queryAll?r.query:undefined};});},changeState:function l(m){c('MessengerDispatcher').dispatch({type:i.REPLACE_STATE,nextState:m});},showDialog:function l(m,n){c('MessengerDispatcher').dispatch({type:j.Types.SHOW_DIALOG,dialogClass:m,dialogProps:n});},hideDialog:function l(m){c('MessengerDispatcher').dispatch({type:j.Types.HIDE_DIALOG,dialogClass:m});},changeFolder:function l(m){k(function(n){if(n.folder!==m)return {folder:m};});},changeFilter:function l(m){k(function(n){if(n.filter!==m)return {filter:m};});},changeQuery:function l(m){k(function(n){if(n.query!==m)return {query:m};});},changeQueryAll:function l(m){var n=!!m;k(function(o){if(o.queryAll!==m)return {query:m,queryAll:n};});},changeMid:function l(m){k(function(n){if(n.mid!==m)return {mid:m};});}};function k(l){var m=c('MessengerURISerializer').deserialize(new (c('URI'))(window.location.href)),n=l(m);if(n)c('goURI')(c('MessengerURISerializer').serialize(Object.assign(m,n)));}f.exports=j;}),null);
__d('MNCommerceDialogStateStore',['FluxStore','MessengerDispatcher','MNCommerceActionTypes'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('FluxStore'));i=h&&h.prototype;function j(){i.constructor.call(this,c('MessengerDispatcher'));this.$MNCommerceDialogStateStore1=null;this.$MNCommerceDialogStateStore2=null;}j.prototype.__onDispatch=function(k){var l=k.type;switch(l){case c('MNCommerceActionTypes').DIALOG.SHOW:this.$MNCommerceDialogStateStore1=k.dialogContainer;this.$MNCommerceDialogStateStore2=k.state;this.__emitChange();break;case c('MNCommerceActionTypes').DIALOG.HIDE:this.$MNCommerceDialogStateStore1=null;this.$MNCommerceDialogStateStore2=null;this.__emitChange();break;}};j.prototype.getDialogContainer=function(){return this.$MNCommerceDialogStateStore1;};j.prototype.getState=function(){return this.$MNCommerceDialogStateStore2;};f.exports=new j();}),null);
__d('MercuryTypeaheadDataSource',['CurrentUser','DataSource','MercuryConfig','MercuryParticipantTypes','MercuryTypeaheadConstants','OrderedFriendsList','ShortProfiles','WorkModeConfig','debounce'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();var j=500,k=[],l={},m={},n={},o=false,p=false;h=babelHelpers.inherits(q,c('DataSource'));i=h&&h.prototype;function q(r){'use strict';r=r||{};r.kanaNormalization=true;i.constructor.call(this,r);}q.prototype.dirty=function(){'use strict';this.$MercuryTypeaheadDataSource1=k;this.localCache=m;this.queryCache=l;this.queryIDs=n;return this;};q.prototype.bootstrap=function(){'use strict';if(o||p)return false;p=true;c('ShortProfiles').fetchAll().then(function(){this.updateBootstrapData();p=false;o=true;}.bind(this),function(){}.bind(this));return true;};q.prototype.updateBootstrapData=function(){'use strict';var r=this.getCachedShortProfileIDs(),s=c('WorkModeConfig').is_work_user?c('MercuryParticipantTypes').FB4C:c('MercuryParticipantTypes').FRIEND,t=r.map(function(u){var v=c('ShortProfiles').getNow(u),w=u==c('CurrentUser').getID()?s:v.type,x=[v.additionalName,v.alternateName].concat(v.searchTokens||[]).join(' '),y=v.name,z=null;if(v.threadNickname){y=v.threadNickname;z=v.name;}return {uid:u,index:c('OrderedFriendsList').getActiveRank(u),text:y,subtext:z,tokens:x,localized_text:v.name,additional_text:v.additionalName,photo:v.thumbSrc,render_type:w,type:c('MercuryTypeaheadConstants').USER_TYPE};});if(t.length)this.addEntries(t);};q.prototype.query=function(r,s,t,u){'use strict';var v=s||r.length===1;return i.query.call(this,r,v,t,u);};q.prototype.getQueryData=function(r,s){'use strict';return babelHelpers['extends']({},i.getQueryData.call(this,r,s));};q.prototype.setEntry=function(r,s){'use strict';this.$MercuryTypeaheadDataSource1[r]=s;};q.prototype.getEntry=function(r){'use strict';return this.$MercuryTypeaheadDataSource1[r]||null;};q.prototype.getCachedShortProfileIDs=function(){'use strict';var r=c('ShortProfiles').getCachedProfileIDs(),s=r.filter(function(t){var u=c('ShortProfiles').getNow(t);return (t==c('CurrentUser').getID()||u.type===c('MercuryParticipantTypes').FRIEND||u.type===c('MercuryParticipantTypes').FB4C||u.type===c('MercuryParticipantTypes').PAGE&&c('MercuryConfig').LinkedAgents&&c('MercuryConfig').LinkedAgents.indexOf(t.toString())>-1);});return s;};q.prototype.isBootstrapped=function(){'use strict';return o;};q.prototype.isBootstrapping=function(){'use strict';return p;};q.prototype.processEntries=function(r,s){'use strict';r=r.map(function(t){if(t.index==null&&(t.render_type===c('MercuryParticipantTypes').FRIEND||t.render_type===c('MercuryParticipantTypes').FB4C))t.index=c('OrderedFriendsList').getActiveRank(t.uid);if(t.render_type===c('MercuryParticipantTypes').PAGE&&c('MercuryConfig').LinkedAgents&&c('MercuryConfig').LinkedAgents.indexOf(t.uid.toString())>-1)t.index=1;return t;});return i.processEntries.call(this,r);};q.prototype.mergeUids=function(r,s,t,u){'use strict';var v=s.sort(function(w,x){return this.getEntry(w).index-this.getEntry(x).index;}.bind(this));return i.mergeUids.call(this,r,v,t,u);};f.exports=q;}),null);
__d('PureStoreBasedStateMixin',['invariant','StoreBasedStateMixinHelper','setImmediate'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=function(){for(var j=arguments.length,k=Array(j),l=0;l<j;l++)k[l]=arguments[l];return {getInitialState:function m(){return this.constructor.calculateState();},componentWillMount:function m(){!this.constructor.calculateState?h(0):void 0;this._recalculateStateID=null;var n=function(){if(this.isMounted())this.setState(this.constructor.calculateState());this._recalculateStateID=null;}.bind(this);this._mixin=new (c('StoreBasedStateMixinHelper'))(k);this._mixin.subscribeCallback(function(){if(this._recalculateStateID===null)this._recalculateStateID=c('setImmediate')(n);}.bind(this));},componentWillUnmount:function m(){this._mixin.release();this._mixin=null;}};}.bind(this);f.exports=i;}),null);